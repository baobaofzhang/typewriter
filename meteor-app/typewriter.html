<head>
  <title>Typewriter for Kindle</title>
</head>

<body>
  <div id="synced-display">{{{text}}}</div>
  <div id="raw-text">{{{rawtext}}}</div>
  <textarea id="text-editor"></textarea>
  <button id="sync-button"></button>
  <script>

    function preparePage() {
      if (document.URL.indexOf("editor") == -1) {
        return;
      }

      document.getElementById("synced-display").style.display = "none";

      document.getElementById("text-editor").value = document.getElementById("raw-text").innerHTML.replace('\u0338',"");

      document.getElementById("text-editor").style.display = "block";
      document.getElementById("text-editor").focus();
    }

    document.getElementById("text-editor").onkeyup = function () {
      document.getElementById("sync-button").click();
    }

    document.getElementById("text-editor").onmouseup = function () {
        document.getElementById("sync-button").click();
    }

    setTimeout(preparePage, 3000);

  </script>
</body>